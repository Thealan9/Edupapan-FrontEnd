<ion-app>
  <ion-split-pane contentId="main-content" when="lg" [style.--side-width]="isCollapsed ? '80px' : '280px'">

    <ion-menu contentId="main-content" type="overlay">
      <ion-content class="--background: #0f172a;">
        <div class="flex flex-col h-full bg-slate-900 border-r border-slate-800 transition-all duration-300">

          <div class="p-6 flex items-center justify-between">
            <div *ngIf="!isCollapsed" class="flex items-center gap-3 bg-slate-800/50 p-3 rounded-xl border border-slate-700">
              <div class="bg-blue-600 p-2 rounded-lg shadow-lg shadow-blue-500/20">
                <ion-icon name="grid" class="text-white text-xl flex"></ion-icon>
              </div>
              <span class="text-white font-bold tracking-tight text-lg italic text-nowrap">EDUMEX</span>
            </div>

            <button (click)="isCollapsed = !isCollapsed" class="hidden lg:flex text-slate-400 hover:text-white p-2 hover:bg-slate-800 rounded-lg transition-colors">
              <ion-icon [name]="isCollapsed ? 'chevron-forward-outline' : 'chevron-back-outline'"></ion-icon>
            </button>
          </div>

          <div class="flex-1 px-4 space-y-1">
            <p *ngIf="!isCollapsed" class="text-[10px] uppercase tracking-[0.2em] text-slate-500 font-bold mb-4 ml-2 text-nowrap">Menú Principal</p>

            <ion-menu-toggle auto-hide="false">
              <nav class="space-y-1">
                <ion-item routerLink="/admin/users" routerLinkActive="active-link" lines="none" class="sidebar-item" [class.collapsed]="isCollapsed">
                  <ion-icon slot="start" name="people-outline"></ion-icon>
                  <ion-label *ngIf="!isCollapsed">Usuarios</ion-label>
                </ion-item>

                <ion-item routerLink="/admin/packages" routerLinkActive="active-link" lines="none" class="sidebar-item" [class.collapsed]="isCollapsed">
                  <ion-icon slot="start" name="cube-outline"></ion-icon>
                  <ion-label *ngIf="!isCollapsed">Paquetes</ion-label>
                </ion-item>

                <ion-item routerLink="/admin/books" routerLinkActive="active-link" lines="none" class="sidebar-item" [class.collapsed]="isCollapsed">
                  <ion-icon slot="start" name="book-outline"></ion-icon>
                  <ion-label *ngIf="!isCollapsed">Libros</ion-label>
                </ion-item>

                <ion-item routerLink="/admin/pallets" routerLinkActive="active-link" lines="none" class="sidebar-item" [class.collapsed]="isCollapsed">
                  <ion-icon slot="start" name="layers-outline"></ion-icon>
                  <ion-label *ngIf="!isCollapsed">Pallets</ion-label>
                </ion-item>
              </nav>
            </ion-menu-toggle>

            <div class="my-6 border-t border-slate-800 mx-2"></div>

            <button (click)="openCreate()" class="ticket-btn" [class.collapsed]="isCollapsed">
              <ion-icon name="add-circle"></ion-icon>
              <span *ngIf="!isCollapsed" class="text-nowrap">ABRIR TICKET</span>
            </button>
          </div>

          <div class="p-4 border-t border-slate-800">
            <div id="profile-trigger" class="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-800 transition-colors cursor-pointer" [class.justify-center]="isCollapsed">
              <div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center border border-blue-400/30 shrink-0">
                <ion-icon name="person" class="text-blue-400 text-xl"></ion-icon>
              </div>
              <div *ngIf="!isCollapsed" class="flex-1 min-w-0">
                <p class="text-sm font-semibold text-white truncate">Perfil <ion-icon name="chevron-up-outline"></ion-icon></p>
              </div>
            </div>

            <ion-popover trigger="profile-trigger" triggerAction="click" [dismissOnSelect]="true" class="profile-popover">
              <ng-template>
                <ion-content class="--background: #1e293b;">
                  <ion-list lines="none" class="bg-slate-800 p-2">
                    <ion-item button routerLink="/profile" class="popover-item">
                      <ion-icon slot="start" name="person-outline" class="text-blue-400"></ion-icon>
                      <ion-label class="text-white text-sm">Mi Perfil</ion-label>
                    </ion-item>
                    <div class="h-px bg-slate-700 my-1"></div>
                    <ion-item button (click)="logout()" class="popover-item logout">
                      <ion-icon slot="start" name="log-out-outline" class="text-red-400"></ion-icon>
                      <ion-label class="text-red-400 text-sm">Cerrar Sesión</ion-label>
                    </ion-item>
                  </ion-list>
                </ion-content>
              </ng-template>
            </ion-popover>
          </div>
        </div>
      </ion-content>
    </ion-menu>

    <div class="ion-page" id="main-content">
        <ion-header class="ion-no-border" *ngIf="isMobile$ | async">
            <ion-toolbar class="--background: #0f172a; border-b border-slate-800">
              <ion-buttons slot="start">
                <ion-menu-button class="text-blue-400"></ion-menu-button>
              </ion-buttons>
              <ion-title class="text-white font-bold text-sm tracking-wide">EDUMEX</ion-title>
            </ion-toolbar>
          </ion-header>

          <ion-content class="--background: #f8fafc;">
            <main class="max-w-7xl mx-auto p-6 md:p-10">
              <router-outlet></router-outlet>
            </main>
          </ion-content>
    </div>

  </ion-split-pane>
</ion-app>
